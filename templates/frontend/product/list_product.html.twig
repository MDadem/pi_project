{# templates/frontend/product/list_product.html.twig #}
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>CultureSpace</title>
		<meta content="width=device-width, initial-scale=1.0" name="viewport">
		<meta content="" name="keywords">
		<meta
		content="" name="description">

		<!-- Google Web Fonts -->
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link
		href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">

		<!-- Icon Font Stylesheet -->
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"/>
		<link
		href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

		<!-- Libraries Stylesheet -->
		<link rel="stylesheet" href="{{ absolute_url(asset('lib/animate/animate.min.css')) }}"/>
		<link href="{{ absolute_url(asset('lib/lightbox/css/lightbox.min.css')) }}" rel="stylesheet">
		<link
		href="{{ absolute_url(asset('lib/owlcarousel/assets/owl.carousel.min.css')) }}" rel="stylesheet">

		<!-- Customized Bootstrap Stylesheet -->
		<link
		href="{{ absolute_url(asset('css/bootstrap.min.css')) }}" rel="stylesheet">

		<!-- Template Stylesheet -->
		<link href="{{ absolute_url(asset('css/style.css')) }}" rel="stylesheet">


		{% block stylesheets %}
			<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Open+Sans">
			<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
			<style>
				body {
					background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
					min-height: 100vh;
					font-family: 'Inter', sans-serif;
				}
				h2 {
					color: #2c3e50;
					font-size: 2.5rem;
					font-weight: 800;
					text-align: center;
					text-transform: uppercase;
					position: relative;
					margin: 3rem 0 4rem;
				}
				h2:after {
					content: '';
					position: absolute;
					width: 120px;
					height: 5px;
					background: linear-gradient(to right, #7ac400, #a3e635);
					left: 50%;
					bottom: -20px;
					transform: translateX(-50%);
					border-radius: 2px;
				}
				.container-xl {
					padding: 0 2rem;
					position: relative;
				}
				/* Premium Filter Panel with Scroll */
				.filter-panel {
					position: fixed;
					top: 150px;
					left: 20px;
					width: 300px;
					max-height: 70vh;
					background: rgba(255, 255, 255, 0.95);
					border-radius: 20px;
					box-shadow: 0 10px 50px rgba(0, 0, 0, 0.15);
					padding: 2rem;
					z-index: 1000;
					transition: all 0.4s ease;
					transform: translateX(-100%);
					backdrop-filter: blur(5px);
					overflow-y: auto;
					scrollbar-width: thin;
					scrollbar-color: #7ac400 rgba(0, 0, 0, 0.1);
				}
				.filter-panel::-webkit-scrollbar {
					width: 8px;
				}
				.filter-panel::-webkit-scrollbar-track {
					background: rgba(0, 0, 0, 0.1);
					border-radius: 10px;
				}
				.filter-panel::-webkit-scrollbar-thumb {
					background: #7ac400;
					border-radius: 10px;
				}
				.filter-panel::-webkit-scrollbar-thumb:hover {
					background: #a3e635;
				}
				.filter-panel.active {
					transform: translateX(0);
				}
				.filter-panel:before {
					content: '';
					position: absolute;
					top: -50%;
					left: -50%;
					width: 200%;
					height: 200%;
					background: radial-gradient(circle, rgba(122,196,0,0.1) 0%, transparent 70%);
					transform: rotate(30deg);
					pointer-events: none;
				}
				.filter-toggle {
					position: fixed;
					top: 120px;
					left: 20px;
					background: linear-gradient(45deg, #7ac400, #a3e635);
					color: white;
					border: none;
					border-radius: 50%;
					width: 50px;
					height: 50px;
					font-size: 1.5rem;
					display: flex;
					align-items: center;
					justify-content: center;
					cursor: pointer;
					box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
					transition: all 0.3s ease;
					z-index: 1001;
				}
				.filter-toggle:hover {
					transform: scale(1.1);
					box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
				}
				.filter-panel h3 {
					color: #2c3e50;
					font-size: 1.5rem;
					font-weight: 700;
					margin-bottom: 1.5rem;
					position: relative;
				}
				.filter-panel h3:after {
					content: '';
					position: absolute;
					bottom: -5px;
					left: 0;
					width: 50px;
					height: 3px;
					background: linear-gradient(to right, #7ac400, #a3e635);
				}
				.filter-panel .form-control,
				.filter-panel .form-select {
					border-radius: 10px;
					border: 2px solid #dee2e6;
					padding: 0.75rem 1rem;
					background: rgba(255, 255, 255, 0.8);
					transition: all 0.3s ease;
					margin-bottom: 1rem;
					box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.05);
				}
				.filter-panel .form-control:focus,
				.filter-panel .form-select:focus {
					border-color: #7ac400;
					box-shadow: 0 0 10px rgba(122, 196, 0, 0.3);
					background: white;
				}
				.filter-panel .btn-primary {
					width: 100%;
					border-radius: 25px;
					padding: 0.75rem;
					font-weight: 700;
					text-transform: uppercase;
					letter-spacing: 1px;
					background: linear-gradient(45deg, #7ac400, #a3e635);
					border: none;
					transition: all 0.4s ease;
					position: relative;
					overflow: hidden;
				}
				.filter-panel .btn-primary:before {
					content: '';
					position: absolute;
					top: 50%;
					left: 50%;
					width: 0;
					height: 0;
					background: rgba(255, 255, 255, 0.2);
					border-radius: 50%;
					transform: translate(-50%, -50%);
					transition: width 0.6s ease, height 0.6s ease;
				}
				.filter-panel .btn-primary:hover:before {
					width: 300px;
					height: 300px;
				}
				.filter-panel .btn-primary:hover {
					transform: translateY(-3px);
					box-shadow: 0 8px 25px rgba(122, 196, 0, 0.4);
				}
				/* Carousel Styling */
				.carousel {
					margin: 0 auto;
					padding: 0 70px;
				}
				.carousel-item {
					transition: transform 0.5s ease, opacity 0.5s ease;
				}
				.thumb-wrapper {
					padding: 2rem;
					background: rgba(255, 255, 255, 0.95);
					border-radius: 15px;
					text-align: center;
					position: relative;
					box-shadow: 0 5px 25px rgba(0, 0, 0, 0.1);
					transition: all 0.4s ease;
					overflow: hidden;
					backdrop-filter: blur(2px);
				}
				.thumb-wrapper:hover {
					transform: translateY(-10px);
					box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
				}
				.thumb-wrapper:before {
					content: '';
					position: absolute;
					top: -50%;
					left: -50%;
					width: 200%;
					height: 200%;
					background: radial-gradient(circle, rgba(122,196,0,0.05) 0%, transparent 70%);
					transform: rotate(30deg);
					pointer-events: none;
				}
				.img-box {
					height: 150px;
					margin-bottom: 1.5rem;
					position: relative;
					overflow: hidden;
					border-radius: 10px;
				}
				.img-box img {
					max-width: 100%;
					max-height: 100%;
					position: absolute;
					bottom: 0;
					left: 50%;
					transform: translateX(-50%);
					transition: all 0.3s ease;
				}
				.thumb-wrapper:hover .img-box img {
					transform: translateX(-50%) scale(1.05);
				}
				.thumb-content h4 {
					font-size: 1.25rem;
					color: #2c3e50;
					font-weight: 700;
					margin-bottom: 1rem;
				}
				.thumb-content p {
					font-size: 0.95rem;
					color: #34495e;
					margin-bottom: 0.75rem;
				}
				.item-price {
					font-size: 1.1rem;
					color: #7ac400;
					font-weight: 600;
					margin-bottom: 1rem;
				}
				.stock-status {
					display: inline-block;
					padding: 0.5rem 1rem;
					border-radius: 20px;
					font-size: 0.9rem;
					font-weight: 600;
					text-transform: uppercase;
					transition: all 0.3s ease;
					margin-bottom: 1rem;
				}
				.stock-status.in-stock {
					background: linear-gradient(45deg, #7ac400, #a3e635);
					color: white;
				}
				.stock-status.out-of-stock {
					background: linear-gradient(45deg, #ff416c, #ff4b2b);
					color: white;
				}
				.stock-status:hover {
					transform: scale(1.05);
					box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
				}
				.thumb-content .btn {
					border-radius: 20px;
					padding: 0.5rem 1.5rem;
					font-weight: 600;
					text-transform: uppercase;
					letter-spacing: 0.5px;
					margin: 0.5rem 0.25rem;
					transition: all 0.3s ease;
				}
				.btn-warning {
					background: linear-gradient(45deg, #ffb347, #ffcc33);
					border: none;
				}
				.btn-danger {
					background: linear-gradient(45deg, #ff416c, #ff4b2b);
					border: none;
				}
				.btn-primary {
					background: linear-gradient(45deg, #7ac400, #a3e635);
					border: none;
				}
				.thumb-content .btn:hover {
					transform: translateY(-2px);
					box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
				}
				.carousel-control-prev,
				.carousel-control-next {
					height: 50px;
					width: 50px;
					background: linear-gradient(45deg, #7ac400, #a3e635);
					border-radius: 50%;
					opacity: 0.9;
					top: 50%;
					transform: translateY(-50%);
				}
				.carousel-control-prev:hover,
				.carousel-control-next:hover {
					background: linear-gradient(45deg, #a3e635, #7ac400);
					opacity: 1;
					transform: translateY(-50%) scale(1.1);
				}
				.carousel-control-prev i,
				.carousel-control-next i {
					font-size: 2rem;
					color: white;
					text-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
				}
				.carousel-indicators {
					bottom: -60px;
				}
				.carousel-indicators li {
					width: 12px;
					height: 12px;
					background: rgba(122, 196, 0, 0.3);
					border-radius: 50%;
					transition: all 0.3s ease;
				}
				.carousel-indicators li.active {
					background: #7ac400;
					transform: scale(1.2);
				}
				.wish-icon {
					position: absolute;
					right: 15px;
					top: 15px;
					font-size: 1.25rem;
					color: #abb0b8;
					transition: all 0.3s ease;
					cursor: pointer;
				}
				.wish-icon:hover {
					color: #ff6161;
					transform: scale(1.2);
				}
				.wish-icon .fa-heart {
					color: #ff6161;
				}
			</style>
		{% endblock %}
	</head>
	<body>
		{% include 'frontend/topbar/topbar.html.twig' %}
		{% include 'frontend/navbar/navbar.html.twig' %}

		{% block body %}
			<div
				class="container-xl mt-4">
				<!-- PDF Download Button -->
				<div class="text-right mb-3">
					<a href="{{ path('product_list_pdf', app.request.query.all) }}" class="btn btn-success">
						<i class="fa fa-download"></i>
						Download PDF
					</a>
				</div>

				<!-- Filter Panel Toggle Button -->
				<button class="filter-toggle" id="filterToggle" title="Toggle Filters">
					<i class="fas fa-filter"></i>
				</button>

				<!-- Premium Filter Panel with Scroll -->
				<form method="get" action="{{ path('product_list') }}" class="filter-panel" id="filterPanel">
					<h3>Filter Products</h3>
					<div class="row g-3">
						<div class="col-12">
							<input type="text" name="name" placeholder="Product Name" value="{{ app.request.get('name') }}" class="form-control">
						</div>
						<div class="col-12">
							<input type="date" name="date_from" placeholder="Date From" value="{{ app.request.get('date_from') }}" class="form-control">
						</div>
						<div class="col-12">
							<input type="date" name="date_to" placeholder="Date To" value="{{ app.request.get('date_to') }}" class="form-control">
						</div>
						<div class="col-12">
							<select name="category" class="form-select">
								<option value="">All Categories</option>
								{% for cat in categories %}
									<option value="{{ cat.id }}" {% if app.request.get('category') == cat.id %} selected {% endif %}>
										{{ cat.name }}
									</option>
								{% endfor %}
							</select>
						</div>
						<div class="col-12">
							<input type="number" step="0.01" name="price_min" placeholder="Min Price" value="{{ app.request.get('price_min') }}" class="form-control">
						</div>
						<div class="col-12">
							<input type="number" step="0.01" name="price_max" placeholder="Max Price" value="{{ app.request.get('price_max') }}" class="form-control">
						</div>
						<div class="col-12">
							<select name="availability" class="form-select">
								<option value="all" {% if app.request.get('availability') == 'all' or app.request.get('availability') is empty %} selected {% endif %}>All</option>
								<option value="available" {% if app.request.get('availability') == 'available' %} selected {% endif %}>Available</option>
								<option value="unavailable" {% if app.request.get('availability') == 'unavailable' %} selected {% endif %}>Unavailable</option>
							</select>
						</div>
						<!-- New Discount Filter -->
						<div class="col-12">
							<select name="discount" class="form-select">
								<option value="all" {% if app.request.get('discount') == 'all' or app.request.get('discount') is empty %} selected {% endif %}>All</option>
								<option value="discounted" {% if app.request.get('discount') == 'discounted' %} selected {% endif %}>Discounted</option>
								<option value="non_discounted" {% if app.request.get('discount') == 'non_discounted' %} selected {% endif %}>Non-Discounted</option>
							</select>
						</div>
						<div class="col-12">
							<button type="submit" class="btn btn-primary">Apply Filters</button>
						</div>
					</div>
				</form>

				<!-- Product List Container for Ajax Updates -->
				{# Sorting is already handled in the controller for PDF generation; if needed, you can sort here as well #}
				<div id="product-list-container">
					<div class="row">
						<div class="col-md-12">
							<h2>Featured
								<b>Products</b>
							</h2>
							<div id="myCarousel" class="carousel slide" data-ride="carousel" data-interval="0">
								{% set groups = products|batch(4) %}
								<!-- Carousel indicators -->
								<ol class="carousel-indicators">
									{% for group in groups %}
										<li data-target="#myCarousel" data-slide-to="{{ loop.index0 }}" class="{{ loop.first ? 'active' : '' }}"></li>
									{% endfor %}
								</ol>
								<!-- Wrapper for carousel items -->
								<div class="carousel-inner">
									{% for productGroup in groups %}
										<div class="item carousel-item {{ loop.first ? 'active' : '' }}">
											<div class="row g-4">
												{% for product in productGroup %}
													<div class="col-sm-3">
														<div class="thumb-wrapper wow fadeInUp" data-wow-delay="{{ loop.index0 * 0.1 }}s">
															<span class="wish-icon">
																<i class="fa fa-heart-o"></i>
															</span>
															<div class="img-box">
																<img src="{{ product.imageUrl }}" class="img-fluid" alt="{{ product.productName }}">
															</div>
															<div class="thumb-content">
																<h4>{{ product.productName }}</h4>
																<p>{{ product.productDescription }}</p>
																<p>{{ product.productCategory.name }}</p>
																<span class="stock-status {{ product.productStock > 0 ? 'in-stock' : 'out-of-stock' }}">
																	{{ product.productStock > 0 ? 'In Stock' : 'Out of Stock' }}
																</span>
																{% if product.discount %}
																	<p class="item-price">
																		<span style="text-decoration: line-through;">${{ product.productPrice }}</span>
																		<span>${{ (product.productPrice * (1 - product.discount / 100))|number_format(2) }}</span>
																	</p>
																{% else %}
																	<p class="item-price">
																		<b>${{ product.productPrice }}</b>
																	</p>
																{% endif %}
																<div>
																	<a href="{{ path('product_edit', {id: product.id}) }}" class="btn btn-warning">Edit</a>
																	<form action="{{ path('product_delete', {id: product.id}) }}" method="post" style="display:inline-block;" onsubmit="return confirm('Are you sure you want to delete this product?');">
																		<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ product.id) }}">
																		<button class="btn btn-danger">Delete</button>
																	</form>
																	<a href="#" class="btn btn-primary">Add to Cart</a>
																</div>
															</div>
														</div>
													</div>
												{% endfor %}
											</div>
										</div>
									{% endfor %}
								</div>
								<!-- Carousel controls -->
								<a class="carousel-control-prev" href="#myCarousel" data-slide="prev">
									<i class="fa fa-angle-left"></i>
								</a>
								<a class="carousel-control-next" href="#myCarousel" data-slide="next">
									<i class="fa fa-angle-right"></i>
								</a>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Include jQuery and Bootstrap JS (for Bootstrap 4) -->
			<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
			<script src="{{ asset('js/bootstrap.min.js') }}"></script>

			<!-- JavaScript for Filter Toggle and Ajax Submission -->
			<script>
				document.addEventListener("DOMContentLoaded", function () {
const filterToggle = document.getElementById('filterToggle');
const filterPanel = document.getElementById('filterPanel');
const filterForm = filterPanel; // our form element
const productListContainer = document.getElementById('product-list-container');

filterToggle.addEventListener('click', function () {
filterPanel.classList.toggle('active');
});

filterForm.addEventListener('submit', function (e) {
e.preventDefault();
const formData = new FormData(filterForm);
const queryString = new URLSearchParams(formData).toString();
fetch(filterForm.action + '?' + queryString, {
headers: {
'X-Requested-With': 'XMLHttpRequest'
}
}).then(response => response.text()).then(html => { // Parse the returned HTML and update the product list container
const parser = new DOMParser();
const doc = parser.parseFromString(html, 'text/html');
const newContent = doc.getElementById('product-list-container');
if (newContent) {
productListContainer.innerHTML = newContent.innerHTML;
// Dispose previous carousel instance if it exists and reinitialize
if ($('#myCarousel').data('bs.carousel')) {
$('#myCarousel').carousel('dispose');
}
$('#myCarousel').carousel({interval: 0});
}
}).catch(error => console.error('Error fetching filtered products:', error));
});
});
			</script>
		{% endblock %}

		{% include 'frontend/footer/footer.html.twig' %}
	</body>
</html>
